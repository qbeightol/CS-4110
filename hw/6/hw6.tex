\documentclass[10pt, oneside]{article}
\usepackage{geometry}
\geometry{letterpaper}
\usepackage{amssymb, amsmath, enumerate, bussproofs}


\begin{document}
\noindent Ameya Acharya (apa52) and Quinn Beightol (qeb2) \\
\noindent CS 4110 \\
\noindent Homework 6 \\
\noindent Wednesday, October 29 \\

\begin{enumerate}
	\item
	\begin{prooftree}
		\AxiomC{$e1 \Downarrow v1$}
		\AxiomC{$v1 \text{ } e2 \Downarrow v$}
		\BinaryInfC{$e1 \text{ } e2 \Downarrow v$}
	\end{prooftree}
	\begin{prooftree}
		\AxiomC{$e1\{e2/x\} \Downarrow v$}
		\UnaryInfC{$(\lambda x.e1) \text{ } e2 \Downarrow v$}
	\end{prooftree}
	\item
	\begin{enumerate}
		\item $\textsf{EQUAL} = \lambda m. \lambda n. \textsf{ AND } (\textsf{IS\_ZERO } (\textsf{SUB } m \text{ } n)) \text{ } (\textsf{IS\_ZERO } (\text{SUB } n \text{ } m))$
		
		\item
		\begin{eqnarray*}
			\textsf{NIL} & \triangleq & \lambda n.\lambda c.n\\
			\textsf{CONS} & \triangleq & \lambda h.\lambda t.\lambda n.\lambda c. c \text{ } h \text{ } t\\
			\textsf{HD} & \triangleq & \lambda l.l \textsf{ NIL } (\lambda h.\lambda t.h)\\
			\textsf{TL} & \triangleq & \lambda l.l \textsf{ NIL } (\lambda h.\lambda t.t)\\
			\textsf{IS\_NIL} & \triangleq & \lambda l.l \textsf{ TRUE } (\lambda h.\lambda t.\textsf{FALSE})\\
		\end{eqnarray*}
		
		
		
		\item $$\textsf{SUM'} \triangleq \lambda f\lambda l.l \text{ } \bar{0} \text{ } (\lambda h.\lambda t.\textsf{ PLUS } h \text{ } (\textsf{f f } t))$$
		
			$$\textsf{SUM} \triangleq \textsf{SUM'} \textsf{ } \textsf{SUM'}$$
		
	\end{enumerate}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%3%%%%%%%%%%%%%%%%%%%%%%%
	\item 
		\begin{enumerate}
		\item \begin{prooftree}
		\AxiomC{$\Gamma \vdash e: \tau \rightarrow \tau_1$}
		\UnaryInfC{$\Gamma \vdash \textsf{fix } e: \tau \rightarrow \tau_1$}
	\end{prooftree}

		\item The progress lemma states that if $\vdash e : \tau $ then either $e$ is a value or there exists an $e'$ such that $ e \rightarrow e'.$
		We proceed by induction on the derivation of e.\\
					
		{\sc Case} $e =  \textsf{fix } e_1: \tau$\\
		
		Using our typing rule in a), if $e: \tau$, $\tau =  \tau_1 \rightarrow \tau_2.$ So, we know that $e_1: \tau$, or, more specifically, $e_1: \tau_1 \rightarrow \tau_2$ as well.\\
		
		From our inductive hypothesis, since  $e_1: \tau$,  either $e_1$ is a value or there exists an $e_1'$ such that $e_1 \rightarrow e_1'.$\\
		
		\begin{itemize}
		\item {\sc Subcase} $e_1 \rightarrow e_1'$ \\
		
		By {\sc context}, since $e_1 \rightarrow e_1',$ $\textsf{fix } e_1 \rightarrow \textsf{fix }e_1'.$ Therefore, $\exists e'' = \textsf{fix }e_1'$ such that $e \rightarrow e''.$ That concludes this subcase. \checkmark \checkmark \\
		
		\item {\sc Subcase} $e_1$ is a value:\\
		
		Since $e_1: \tau \rightarrow \tau',$ by canonical forms, we know that $e_1 = \lambda x:\tau e_2$\\

		\begin{itemize}
		\item {\sc Subsubcase} $e_1 = n$\\ 
		
		\item {\sc Subsubcase} $e_1 = ()$\\  
		
		\item {\sc Subsubcase} $e_1 = \lambda x: e_2$\\
		This case steps, by the small-step semantics rule given to us in problem 3 of the homework. That concludes this subcase and the whole case.\\
		\end{itemize}
		\end{itemize}

		
		\item The preservation lemma states that if $\vdash e : \tau $ and $e \rightarrow e'$ then $\vdash e' : \tau.$ We assume $\vdash e : \tau $ and $e \rightarrow e'$, and would like to show that $\vdash e' : \tau $. We proceed by induction on the derivation of $e \rightarrow e'.$\\
		
		Consider the last rule used in the derivation of $e \rightarrow e'.$\\
		
		{\sc Case fix:} 
		We have $e:\tau = \textsf{fix } e_1.$
		\begin{itemize}
		\item {\sc subcase} $e_1$
		\item {\sc subcase} $e_1$ is not a lambda then things
		
		\end{itemize}
		
		
		===========================================
		
		SEE NEW PROOF FOR 3C BELOW

		New type-inference rule:
		\begin{prooftree}
			\AxiomC{$\Gamma \vdash e:(\tau \rightarrow \tau) \rightarrow (\tau \rightarrow \tau)$}
			\UnaryInfC{$\Gamma \vdash \textsf{fix } e: \tau \rightarrow \tau$}
		\end{prooftree}
		
		Assume $\vdash e:\tau_e$ and $e \rightarrow e'$ \\
		
		\underline{Case: $\textsf{fix } e$ evaluation rule:} \\
		Matching on the form of the rule, we can infer
		\begin{itemize}
			\item $e = \textsf{fix } (\lambda x: \tau_x.e_\text{body})$
			\item $e' = e_\text{body} \{\textsf{fix } (\lambda x: \tau_x.e_\text{body}) / x\}$
		\end{itemize}
		
		Since $e$ is a fix point, the only rule that could have been used to determine its type is the inference rule we wrote in 3a:
		
		\begin{prooftree}
			\AxiomC{$ \vdash (\lambda x: \tau_x.e_\text{body}):(\tau \rightarrow \tau) \rightarrow (\tau \rightarrow \tau)$}
			\UnaryInfC{$ \vdash \textsf{fix } (\lambda x: \tau_x.e_\text{body}): \tau \rightarrow \tau$}
		\end{prooftree}
		
		We can end this tree using the inference rule for lambda abstractions (again, 
		only one rule--T-ABS--could have been used to produce a type judgment):
		
		\begin{prooftree}
			\AxiomC{$x : \tau \rightarrow \tau \vdash e_\text{body}: \tau \rightarrow \tau$}
			\UnaryInfC{$ \vdash (\lambda x: \tau_x.e_\text{body}):(\tau \rightarrow \tau) \rightarrow (\tau \rightarrow \tau)$}
			\UnaryInfC{$ \vdash \textsf{fix } (\lambda x: \tau_x.e_\text{body}): \tau \rightarrow \tau$}
		\end{prooftree}
		
		From the above derivation, we know now:
		\begin{itemize}
			\item $x: \tau \rightarrow \tau \vdash e_\text{body} : \tau \rightarrow \tau$
			\item $v = \textsf{fix } (\lambda x: \tau_x.e_\text{body}): \tau \rightarrow \tau$
		\end{itemize}
		
		So we can know use the substitution lemma (if $x:\tau' \vdash e:\tau$ and 
		$\vdash v:\tau'$ then $\vdash e{v/x}: \tau$ to conclude $e' = e_\text{body} 
		\{\textsf{fix } (\lambda x: \tau_x.e_\text{body}) \}$ has type $\tau_e 
		\checkmark$
		
		Note: I think we might be able to change the type of $x$ to $\tau_a \rightarrow 
		\tau_b$ without breaking the proof--which we should probably do if still works 
		for 3b).
	\end{enumerate}
\end{enumerate}




\end{document}